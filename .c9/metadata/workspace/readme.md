{"changed":true,"filter":false,"title":"readme.md","tooltip":"/readme.md","value":"# CS 270 - Spring 2015 - QR Code Scavenger Hunt - Phase 3\n\nIn Phase 2, we set up the framework to associate Events and Locations\ntogether.  In this phase, we will incorporate the functionality in the\nEvent controller to add a Location to an Event listing.\n\nThe first thing to understand is which controller methods in the Events\ncontroller are being utilized in this process.  When we start the Rails\nserver and visit the URL `http://domain/events`, we get a listing of all\nevents.  This is created when the `index` method in the Events\ncontroller retrieves all Event objects in the database and passes them\nto the `index.html.erb` view for rendering.\n\nWhen you click the \"edit\" link for a particular event, that triggers the\n`edit` method in the controller, which simply retrieves that particular\nevent and passes it to the `edit.html.erb` view, which in turn yields\ncontroler to the `_form.html.erb` view for rendering.\n\nNotice the embedded Rails tag `<%= f.submit %>` at the bottom of the\nform page.  This tag renders a \"submit\" button that incorporates the\nchanges made on the edit page.\n\nHow does it do that?  By triggering the `update` method in the Events\ncontroller.  All the values that are entered in the edit form are passed\nalong to that method in the controller to be updated in the database.\n\nRails accomplishes this in the controller through a variable called\n`params`.  This variable is a hash that contains the field names\nfrom the edit form as keys, and their entered values as the hash values.\n\nRecall in Phase 2 we created a checkbox for each Location to be added\nand stored those locations in an array called `add_locations[]`.  This\narray is also passed as a parameter.\n\nSince we have already created the structure for the\nhas_and_belongs_to_many association between Events and Locations, we can\nsimply iterate through this array and shift each location onto the\nEvents.locations array inside the `respond_to` block before we call\n`@event.update`:\n\n```\nLocation.find(params[\"add_locations\"Even]).each do |location|\n  @event.locations << location\nend\n```\n\nThis simply uses the Location.find class method, which can take in an\narray of ids, and iterates over each of them and adds that Location\nobject to the listing of Locations for that event.  We can verify that\nthis has occurred by entering the Rails console and querying the\nLocations for the appropriate Event id.  (i.e., for Event 1,\n`Event.first.locations`.)\n\nNext, we need to update the \"show event\" page to display the\ncurrently associated Locations for each Event.  We do this by adding\nmarkup/embedded Ruby to the `show.html.erb` view as we did for the edit\npage:\n\n```\n<p>\n<strong>Locations:</strong>\n\n<table>\n  <thead>\n    <tr>\n      <th>Name</th>\n      <th>Tag</th>\n      <th colspan=\"3\"></th>\n    </tr>\n  </thead>\n\n  <% @event.locations.each do |location| %>\n    <tr>\n      <td><%= location.name %></td>\n      <td><%= location.tag %></td>\n    </tr>\n  <% end %>\n</table>\n</p>\n```\n\nObviously, the difference is we have no need to edit from this page, so\nwe remove the appropriate markup.\n","undoManager":{"mark":-1,"position":3,"stack":[[{"group":"doc","deltas":[{"start":{"row":41,"column":36},"end":{"row":41,"column":37},"action":"insert","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":37},"end":{"row":41,"column":38},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":38},"end":{"row":41,"column":39},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":39},"end":{"row":41,"column":40},"action":"insert","lines":["n"]}]}]]},"ace":{"folds":[],"scrolltop":420,"scrollleft":0,"selection":{"start":{"row":46,"column":59},"end":{"row":46,"column":59},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":21,"state":"allowBlock","mode":"ace/mode/markdown"}},"timestamp":1427391882003}